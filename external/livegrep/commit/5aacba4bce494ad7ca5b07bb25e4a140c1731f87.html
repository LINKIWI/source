<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Merge pull request #183 from livegrep/bump-deps - livegrep - Fast, regular expression code search service</title>
<meta name="description" content="Fast, regular expression code search service" />
<meta name="author" content="Kevin Lin" />
<link rel="icon" type="image/png" href="https://static.kevinlin.info/favicon.png" />
<link rel="alternate" type="application/atom+xml" title="livegrep Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="livegrep Atom Feed (tags)" href="../tags.xml" />
<style type="text/css">
body{color:#000;background-color:#fff;font-family:monospace}h1,h2,h3,h4,h5,h6{font-size:1em;margin:0}img,h1,h2{vertical-align:middle}img{border:0}a:target{background-color:#ccc}a.d,a.h,a.i{text-decoration:none}a.line{text-decoration:none;user-select:none}#blob a{color:#555}#blob a:hover{color:blue;text-decoration:none}table thead td{font-weight:bold}table td{padding:0 .4em}#content table td{vertical-align:top;white-space:nowrap}#branches tr:hover td,#tags tr:hover td,#index tr:hover td,#log tr:hover td,#files tr:hover td{background-color:#eee}#index tr td:nth-child(2),#tags tr td:nth-child(3),#branches tr td:nth-child(3),#log tr td:nth-child(2){white-space:normal}td.num{text-align:right}.desc{color:#555}hr{border:0;border-top:1px solid #555;height:1px}pre{font-family:monospace}pre a.h{color:#00a}.A,span.i,pre a.i{color:#070}.D,span.d,pre a.d{color:#e00}pre a.h:hover,pre a.i:hover,pre a.d:hover{text-decoration:none}/*# sourceMappingURL=style.css.min.map */
</style>
</head>
<body>
<table><tr><td><a href="/"><img src="https://static.kevinlin.info/favicon.png" alt="" width="32" height="32" /></a></td><td><h1>livegrep</h1><span class="desc">Fast, regular expression code search service</span></td></tr><tr class="url"><td></td><td>git clone <a href="https://source.static.kevinlin.info/external/livegrep.git">https://source.static.kevinlin.info/external/livegrep.git</a></td></tr><tr><td></td><td>
<a href="../log">Log</a> | <a href="../files">Files</a> | <a href="../refs">Refs</a> | <a href="../file/README.md">README</a> | <a href="../file/COPYING">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/5aacba4bce494ad7ca5b07bb25e4a140c1731f87">5aacba4bce494ad7ca5b07bb25e4a140c1731f87</a>
<b>parent</b> <a href="../commit/a293b1ac4decaf0d4ada98ea2b45b09550db1d32">a293b1ac4decaf0d4ada98ea2b45b09550db1d32</a>
<b>Author:</b> Nelson Elhage &lt;<a href="mailto:nelhage@nelhage.com">nelhage@nelhage.com</a>&gt;
<b>Date:</b>   Sun,  2 Sep 2018 15:11:18 -0700

Merge pull request #183 from livegrep/bump-deps

Bump a bunch of dependencies in bazel
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">.circleci/Dockerfile</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">.circleci/build.sh</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">BUILD</a></td><td> | </td><td class="num">31</td><td><span class="i">++++++++++++++++++++++++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">WORKSPACE</a></td><td> | </td><td class="num">39</td><td><span class="i">+++++++++++++++++++++++</span><span class="d">----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">client/test/BUILD</a></td><td> | </td><td class="num">7</td><td><span class="i">++++</span><span class="d">---</span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">cmd/BUILD</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">cmd/lg/BUILD</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">cmd/livegrep-fetch-reindex/BUILD</a></td><td> | </td><td class="num">7</td><td><span class="i">+++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">cmd/livegrep-github-reindex/BUILD</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">cmd/livegrep-reload/BUILD</a></td><td> | </td><td class="num">7</td><td><span class="i">+++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">cmd/livegrep/BUILD</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">jsonframe/BUILD</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">package.sh</a></td><td> | </td><td class="num">9</td><td><span class="i">++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">server/BUILD</a></td><td> | </td><td class="num">8</td><td><span class="i">++++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">server/api/BUILD</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">server/config/BUILD</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">server/log/BUILD</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">server/middleware/BUILD</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">server/reqid/BUILD</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h19">server/templates/BUILD</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">src/proto/BUILD</a></td><td> | </td><td class="num">13</td><td><span class="i">++++++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h21">src/tools/BUILD</a></td><td> | </td><td class="num">14</td><td><span class="i">++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h22">third_party/BUILD.json_c</a></td><td> | </td><td class="num">19</td><td><span class="i">+++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h23">tools/build_defs/externals.bzl</a></td><td> | </td><td class="num">27</td><td><span class="i"></span><span class="d">---------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h24">tools/build_defs/go_externals.bzl</a></td><td> | </td><td class="num">56</td><td><span class="i">++++++++++++++++++++++++++++++</span><span class="d">--------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h25">web/BUILD</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>26 files changed, 187 insertions(+), 106 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/.circleci/Dockerfile">.circleci/Dockerfile</a> b/<a href="../file/.circleci/Dockerfile">.circleci/Dockerfile</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -18,7 +18,7 @@ ADD https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-
</a> RUN tar -C /usr/local/ -xzf /tmp/gcloud.tar.gz
 RUN /usr/local/google-cloud-sdk/install.sh
 
<a href="#h0-0-3" id="h0-0-3" class="d">-RUN wget --quiet -O /tmp/bazel-0.8.1-installer-linux-x86_64.sh \
</a><a href="#h0-0-4" id="h0-0-4" class="d">-  &#39;https://github.com/bazelbuild/bazel/releases/download/0.8.1/bazel-0.8.1-installer-linux-x86_64.sh&#39; &amp;&amp; \
</a><a href="#h0-0-5" id="h0-0-5" class="d">-  chmod +x /tmp/bazel-0.8.1-installer-linux-x86_64.sh
</a><a href="#h0-0-6" id="h0-0-6" class="d">-RUN /tmp/bazel-0.8.1-installer-linux-x86_64.sh
</a><a href="#h0-0-7" id="h0-0-7" class="i">+RUN wget --quiet -O /tmp/bazel-0.16.1-installer-linux-x86_64.sh \
</a><a href="#h0-0-8" id="h0-0-8" class="i">+  &#39;https://github.com/bazelbuild/bazel/releases/download/0.16.1/bazel-0.16.1-installer-linux-x86_64.sh&#39; &amp;&amp; \
</a><a href="#h0-0-9" id="h0-0-9" class="i">+  chmod +x /tmp/bazel-0.16.1-installer-linux-x86_64.sh
</a><a href="#h0-0-10" id="h0-0-10" class="i">+RUN /tmp/bazel-0.16.1-installer-linux-x86_64.sh
</a><b>diff --git a/<a id="h1" href="../file/.circleci/build.sh">.circleci/build.sh</a> b/<a href="../file/.circleci/build.sh">.circleci/build.sh</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -25,6 +25,8 @@ bazel test --test_arg=-test.v //...
</a> # bazel-bin/client/test/go_default_test -test.repo &quot;$(pwd)/deps/linux&quot;
 
 if [ &quot;$GCLOUD_SERVICE_KEY&quot; ]; then
<a href="#h1-0-3" id="h1-0-3" class="i">+    apt install tree
</a><a href="#h1-0-4" id="h1-0-4" class="i">+    tree bazel-bin/
</a>     ./package.sh
     /usr/local/google-cloud-sdk/bin/gsutil cp -a public-read -r builds/ gs://livegrep.appspot.com/
 fi
<b>diff --git a/<a id="h2" href="../file/BUILD">BUILD</a> b/<a href="../file/BUILD">BUILD</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,8 +1,6 @@
</a><a href="#h2-0-0" id="h2-0-0" class="d">-load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_prefix&quot;)
</a><a href="#h2-0-1" id="h2-0-1" class="i">+load(&quot;@bazel_tools//tools/build_defs/pkg:pkg.bzl&quot;, &quot;pkg_tar&quot;)
</a> load(&quot;@compdb//:aspects.bzl&quot;, &quot;compilation_database&quot;)
 
<a href="#h2-0-4" id="h2-0-4" class="d">-go_prefix(&quot;github.com/livegrep/livegrep&quot;)
</a><a href="#h2-0-5" id="h2-0-5" class="d">-
</a> compilation_database(
     name = &quot;compilation_db&quot;,
     exec_root_marker = True,
<a href="#h2-1" id="h2-1" class="h">@@ -11,3 +9,30 @@ compilation_database(
</a>         &quot;//src/tools:codesearchtool&quot;,
     ],
 )
<a href="#h2-1-3" id="h2-1-3" class="i">+
</a><a href="#h2-1-4" id="h2-1-4" class="i">+load(&quot;@bazel_gazelle//:def.bzl&quot;, &quot;gazelle&quot;)
</a><a href="#h2-1-5" id="h2-1-5" class="i">+
</a><a href="#h2-1-6" id="h2-1-6" class="i">+# gazelle:prefix github.com/livegrep/livegrep
</a><a href="#h2-1-7" id="h2-1-7" class="i">+gazelle(name = &quot;gazelle&quot;)
</a><a href="#h2-1-8" id="h2-1-8" class="i">+
</a><a href="#h2-1-9" id="h2-1-9" class="i">+filegroup(
</a><a href="#h2-1-10" id="h2-1-10" class="i">+    name = &quot;docs&quot;,
</a><a href="#h2-1-11" id="h2-1-11" class="i">+    srcs = glob([
</a><a href="#h2-1-12" id="h2-1-12" class="i">+        &quot;doc/**/*&quot;,
</a><a href="#h2-1-13" id="h2-1-13" class="i">+    ]),
</a><a href="#h2-1-14" id="h2-1-14" class="i">+)
</a><a href="#h2-1-15" id="h2-1-15" class="i">+
</a><a href="#h2-1-16" id="h2-1-16" class="i">+pkg_tar(
</a><a href="#h2-1-17" id="h2-1-17" class="i">+    name = &quot;livegrep&quot;,
</a><a href="#h2-1-18" id="h2-1-18" class="i">+    srcs = [
</a><a href="#h2-1-19" id="h2-1-19" class="i">+        &quot;:COPYING&quot;,
</a><a href="#h2-1-20" id="h2-1-20" class="i">+        &quot;:README.md&quot;,
</a><a href="#h2-1-21" id="h2-1-21" class="i">+        &quot;:docs&quot;,
</a><a href="#h2-1-22" id="h2-1-22" class="i">+    ],
</a><a href="#h2-1-23" id="h2-1-23" class="i">+    strip_prefix = &quot;.&quot;,
</a><a href="#h2-1-24" id="h2-1-24" class="i">+    deps = [
</a><a href="#h2-1-25" id="h2-1-25" class="i">+        &quot;//cmd:go_tools&quot;,
</a><a href="#h2-1-26" id="h2-1-26" class="i">+        &quot;//src/tools:cc_tools&quot;,
</a><a href="#h2-1-27" id="h2-1-27" class="i">+        &quot;//web:assets&quot;,
</a><a href="#h2-1-28" id="h2-1-28" class="i">+    ],
</a><a href="#h2-1-29" id="h2-1-29" class="i">+)
</a><b>diff --git a/<a id="h3" href="../file/WORKSPACE">WORKSPACE</a> b/<a href="../file/WORKSPACE">WORKSPACE</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -8,19 +8,17 @@ load(
</a> 
 git_repository(
     name = &quot;org_pubref_rules_protobuf&quot;,
<a href="#h3-0-3" id="h3-0-3" class="d">-    commit = &quot;ff3b7e7963daa7cb3b42f8936bc11eda4b960926&quot;,
</a><a href="#h3-0-4" id="h3-0-4" class="i">+    commit = &quot;5f6195e83e06db2fd110626b0f2dc64e345e6618&quot;,  # v0.8.2
</a>     remote = &quot;https://github.com/pubref/rules_protobuf&quot;,
 )
 
<a href="#h3-0-8" id="h3-0-8" class="d">-load(
</a><a href="#h3-0-9" id="h3-0-9" class="d">-    &quot;//tools/build_defs:externals.bzl&quot;,
</a><a href="#h3-0-10" id="h3-0-10" class="d">-    &quot;new_patched_http_archive&quot;,
</a><a href="#h3-0-11" id="h3-0-11" class="d">-)
</a><a href="#h3-0-12" id="h3-0-12" class="i">+load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)
</a> 
<a href="#h3-0-14" id="h3-0-14" class="d">-new_patched_http_archive(
</a><a href="#h3-0-15" id="h3-0-15" class="i">+http_archive(
</a>     name = &quot;divsufsort&quot;,
     build_file = &quot;//third_party:BUILD.divsufsort&quot;,
<a href="#h3-0-18" id="h3-0-18" class="d">-    patch_file = &quot;//third_party:divsufsort.patch&quot;,
</a><a href="#h3-0-19" id="h3-0-19" class="i">+    patch_args = [&quot;-p1&quot;],
</a><a href="#h3-0-20" id="h3-0-20" class="i">+    patches = [&quot;//third_party:divsufsort.patch&quot;],
</a>     sha256 = &quot;9164cb6044dcb6e430555721e3318d5a8f38871c2da9fd9256665746a69351e0&quot;,
     strip_prefix = &quot;libdivsufsort-2.0.1&quot;,
     type = &quot;tgz&quot;,
<a href="#h3-1" id="h3-1" class="h">@@ -29,13 +27,13 @@ new_patched_http_archive(
</a> 
 git_repository(
     name = &quot;com_googlesource_code_re2&quot;,
<a href="#h3-1-3" id="h3-1-3" class="d">-    commit = &quot;7cf8b88e8f70f97fd4926b56aa87e7f53b2717e0&quot;,
</a><a href="#h3-1-4" id="h3-1-4" class="i">+    commit = &quot;767de83bb7e4bfe3a2d8aec0ec79f9f1f66da30a&quot;,
</a>     remote = &quot;https://github.com/google/re2&quot;,
 )
 
 git_repository(
     name = &quot;gflags&quot;,
<a href="#h3-1-10" id="h3-1-10" class="d">-    commit = &quot;a69b2544d613b4bee404988710503720c487119a&quot;,
</a><a href="#h3-1-11" id="h3-1-11" class="i">+    commit = &quot;660603a3df1c400437260b51c55490a046a12e8a&quot;,
</a>     remote = &quot;https://github.com/gflags/gflags&quot;,
 )
 
<a href="#h3-2" id="h3-2" class="h">@@ -64,11 +62,11 @@ new_http_archive(
</a>     url = &quot;https://github.com/sparsehash/sparsehash/archive/sparsehash-2.0.3.tar.gz&quot;,
 )
 
<a href="#h3-2-3" id="h3-2-3" class="d">-new_patched_http_archive(
</a><a href="#h3-2-4" id="h3-2-4" class="i">+http_archive(
</a>     name = &quot;com_github_json_c&quot;,
<a href="#h3-2-6" id="h3-2-6" class="d">-    add_prefix = &quot;json-c&quot;,
</a>     build_file = &quot;//third_party:BUILD.json_c&quot;,
<a href="#h3-2-8" id="h3-2-8" class="d">-    patch_file = &quot;//third_party:json_c.patch&quot;,
</a><a href="#h3-2-9" id="h3-2-9" class="i">+    patch_args = [&quot;-p1&quot;],
</a><a href="#h3-2-10" id="h3-2-10" class="i">+    patches = [&quot;//third_party:json_c.patch&quot;],
</a>     sha256 = &quot;5a617da9aade997938197ef0f8aabd7f97b670c216dc173977e1d56eef9e1291&quot;,
     strip_prefix = &quot;json-c-0.12.1&quot;,
     url = &quot;https://s3.amazonaws.com/json-c_releases/releases/json-c-0.12.1-nodoc.tar.gz&quot;,
<a href="#h3-3" id="h3-3" class="h">@@ -76,16 +74,26 @@ new_patched_http_archive(
</a> 
 git_repository(
     name = &quot;io_bazel_rules_go&quot;,
<a href="#h3-3-3" id="h3-3-3" class="d">-    commit = &quot;44b3bdf7d3645cbf0cfd786c5f105d0af4cf49ca&quot;,
</a><a href="#h3-3-4" id="h3-3-4" class="i">+    commit = &quot;2ec02d552198da2d42354f1d4e5d951f1889052d&quot;,  # 0.15.1
</a>     remote = &quot;https://github.com/bazelbuild/rules_go.git&quot;,
 )
 
<a href="#h3-3-8" id="h3-3-8" class="d">-load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_rules_dependencies&quot;, &quot;go_register_toolchains&quot;)
</a><a href="#h3-3-9" id="h3-3-9" class="i">+http_archive(
</a><a href="#h3-3-10" id="h3-3-10" class="i">+    name = &quot;bazel_gazelle&quot;,
</a><a href="#h3-3-11" id="h3-3-11" class="i">+    sha256 = &quot;c0a5739d12c6d05b6c1ad56f2200cb0b57c5a70e03ebd2f7b87ce88cabf09c7b&quot;,
</a><a href="#h3-3-12" id="h3-3-12" class="i">+    urls = [&quot;https://github.com/bazelbuild/bazel-gazelle/releases/download/0.14.0/bazel-gazelle-0.14.0.tar.gz&quot;],
</a><a href="#h3-3-13" id="h3-3-13" class="i">+)
</a><a href="#h3-3-14" id="h3-3-14" class="i">+
</a><a href="#h3-3-15" id="h3-3-15" class="i">+load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_register_toolchains&quot;, &quot;go_rules_dependencies&quot;)
</a> 
 go_rules_dependencies()
 
 go_register_toolchains()
 
<a href="#h3-3-21" id="h3-3-21" class="i">+load(&quot;@bazel_gazelle//:deps.bzl&quot;, &quot;gazelle_dependencies&quot;)
</a><a href="#h3-3-22" id="h3-3-22" class="i">+
</a><a href="#h3-3-23" id="h3-3-23" class="i">+gazelle_dependencies()
</a><a href="#h3-3-24" id="h3-3-24" class="i">+
</a> load(
     &quot;//tools/build_defs:go_externals.bzl&quot;,
     &quot;go_externals&quot;,
<a href="#h3-4" id="h3-4" class="h">@@ -106,7 +114,6 @@ new_libgit2_archive(
</a>     version = &quot;0.24.1&quot;,
 )
 
<a href="#h3-4-3" id="h3-4-3" class="d">-load(&quot;@org_pubref_rules_protobuf//go:rules.bzl&quot;, &quot;go_proto_repositories&quot;)
</a> load(&quot;@org_pubref_rules_protobuf//cpp:rules.bzl&quot;, &quot;cpp_proto_repositories&quot;)
 
 cpp_proto_repositories(excludes = [
<a href="#h3-5" id="h3-5" class="h">@@ -116,7 +123,7 @@ cpp_proto_repositories(excludes = [
</a> 
 git_repository(
     name = &quot;io_bazel_buildifier&quot;,
<a href="#h3-5-3" id="h3-5-3" class="d">-    commit = &quot;0ca1d7991357ae7a7555589af88930d82cf07c0a&quot;,
</a><a href="#h3-5-4" id="h3-5-4" class="i">+    commit = &quot;ae772d29d07002dfd89ed1d9ff673a1721f1b8dd&quot;,
</a>     remote = &quot;https://github.com/bazelbuild/buildifier.git&quot;,
 )
 
<b>diff --git a/<a id="h4" href="../file/client/test/BUILD">client/test/BUILD</a> b/<a href="../file/client/test/BUILD">client/test/BUILD</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,14 +1,15 @@
</a> # gazelle:ignore
 load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_library&quot;, &quot;go_test&quot;)
<a href="#h4-0-2" id="h4-0-2" class="d">-load(&quot;@org_pubref_rules_protobuf//go:rules.bzl&quot;, &quot;GRPC_COMPILE_DEPS&quot;)
</a> 
 go_library(
     name = &quot;go_default_library&quot;,
     srcs = [&quot;testutil.go&quot;],
<a href="#h4-0-7" id="h4-0-7" class="i">+    importpath = &quot;github.com/livegrep/livegrep/client&quot;,
</a>     visibility = [&quot;//visibility:public&quot;],
     deps = [
         &quot;//src/proto:go_proto&quot;,
<a href="#h4-0-11" id="h4-0-11" class="d">-    ] + GRPC_COMPILE_DEPS,
</a><a href="#h4-0-12" id="h4-0-12" class="i">+        &quot;@org_golang_google_grpc//:go_default_library&quot;,
</a><a href="#h4-0-13" id="h4-0-13" class="i">+    ],
</a> )
 
 go_test(
<a href="#h4-1" id="h4-1" class="h">@@ -17,7 +18,7 @@ go_test(
</a>         &quot;bench_test.go&quot;,
         &quot;integration_test.go&quot;,
     ],
<a href="#h4-1-3" id="h4-1-3" class="d">-    library = &quot;:go_default_library&quot;,
</a><a href="#h4-1-4" id="h4-1-4" class="i">+    embed = [&quot;:go_default_library&quot;],
</a>     deps = [
         &quot;//src/proto:go_proto&quot;,
         &quot;@in_gopkg_check_v1//:go_default_library&quot;,
<b>diff --git a/<a id="h5" href="../file/cmd/BUILD">cmd/BUILD</a> b/<a href="../file/cmd/BUILD">cmd/BUILD</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,17 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+load(&quot;@bazel_tools//tools/build_defs/pkg:pkg.bzl&quot;, &quot;pkg_tar&quot;)
</a><a href="#h5-0-1" id="h5-0-1" class="i">+
</a><a href="#h5-0-2" id="h5-0-2" class="i">+pkg_tar(
</a><a href="#h5-0-3" id="h5-0-3" class="i">+    name = &quot;go_tools&quot;,
</a><a href="#h5-0-4" id="h5-0-4" class="i">+    srcs = [
</a><a href="#h5-0-5" id="h5-0-5" class="i">+        &quot;//cmd/{}:{}&quot;.format(cmd, cmd)
</a><a href="#h5-0-6" id="h5-0-6" class="i">+        for cmd in [
</a><a href="#h5-0-7" id="h5-0-7" class="i">+            &quot;lg&quot;,
</a><a href="#h5-0-8" id="h5-0-8" class="i">+            &quot;livegrep&quot;,
</a><a href="#h5-0-9" id="h5-0-9" class="i">+            &quot;livegrep-fetch-reindex&quot;,
</a><a href="#h5-0-10" id="h5-0-10" class="i">+            &quot;livegrep-github-reindex&quot;,
</a><a href="#h5-0-11" id="h5-0-11" class="i">+            &quot;livegrep-reload&quot;,
</a><a href="#h5-0-12" id="h5-0-12" class="i">+        ]
</a><a href="#h5-0-13" id="h5-0-13" class="i">+    ],
</a><a href="#h5-0-14" id="h5-0-14" class="i">+    package_dir = &quot;/bin&quot;,
</a><a href="#h5-0-15" id="h5-0-15" class="i">+    visibility = [&quot;//visibility:public&quot;],
</a><a href="#h5-0-16" id="h5-0-16" class="i">+)
</a><b>diff --git a/<a id="h6" href="../file/cmd/lg/BUILD">cmd/lg/BUILD</a> b/<a href="../file/cmd/lg/BUILD">cmd/lg/BUILD</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -3,6 +3,7 @@ load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_binary&quot;, &quot;go_library&quot;)
</a> go_library(
     name = &quot;go_default_library&quot;,
     srcs = [&quot;main.go&quot;],
<a href="#h6-0-3" id="h6-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/cmd/lg&quot;,
</a>     visibility = [&quot;//visibility:private&quot;],
     deps = [
         &quot;//server/api:go_default_library&quot;,
<a href="#h6-1" id="h6-1" class="h">@@ -12,6 +13,6 @@ go_library(
</a> 
 go_binary(
     name = &quot;lg&quot;,
<a href="#h6-1-3" id="h6-1-3" class="d">-    library = &quot;:go_default_library&quot;,
</a><a href="#h6-1-4" id="h6-1-4" class="i">+    embed = [&quot;:go_default_library&quot;],
</a>     visibility = [&quot;//visibility:public&quot;],
 )
<b>diff --git a/<a id="h7" href="../file/cmd/livegrep-fetch-reindex/BUILD">cmd/livegrep-fetch-reindex/BUILD</a> b/<a href="../file/cmd/livegrep-fetch-reindex/BUILD">cmd/livegrep-fetch-reindex/BUILD</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -2,12 +2,11 @@ load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_binary&quot;, &quot;go_library&quot;)
</a> 
 go_library(
     name = &quot;go_default_library&quot;,
<a href="#h7-0-3" id="h7-0-3" class="d">-    srcs = [
</a><a href="#h7-0-4" id="h7-0-4" class="d">-        &quot;main.go&quot;,
</a><a href="#h7-0-5" id="h7-0-5" class="d">-    ],
</a><a href="#h7-0-6" id="h7-0-6" class="i">+    srcs = [&quot;main.go&quot;],
</a>     data = [
         &quot;//src/tools:codesearch&quot;,
     ],
<a href="#h7-0-10" id="h7-0-10" class="i">+    importpath = &quot;github.com/livegrep/livegrep/cmd/livegrep-fetch-reindex&quot;,
</a>     visibility = [&quot;//visibility:private&quot;],
     deps = [
         &quot;//src/proto:go_proto&quot;,
<a href="#h7-1" id="h7-1" class="h">@@ -17,6 +16,6 @@ go_library(
</a> 
 go_binary(
     name = &quot;livegrep-fetch-reindex&quot;,
<a href="#h7-1-3" id="h7-1-3" class="d">-    library = &quot;:go_default_library&quot;,
</a><a href="#h7-1-4" id="h7-1-4" class="i">+    embed = [&quot;:go_default_library&quot;],
</a>     visibility = [&quot;//visibility:public&quot;],
 )
<b>diff --git a/<a id="h8" href="../file/cmd/livegrep-github-reindex/BUILD">cmd/livegrep-github-reindex/BUILD</a> b/<a href="../file/cmd/livegrep-github-reindex/BUILD">cmd/livegrep-github-reindex/BUILD</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -6,6 +6,7 @@ go_library(
</a>         &quot;flags.go&quot;,
         &quot;main.go&quot;,
     ],
<a href="#h8-0-3" id="h8-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/cmd/livegrep-github-reindex&quot;,
</a>     visibility = [&quot;//visibility:private&quot;],
     deps = [
         &quot;@com_github_google_go_github//github:go_default_library&quot;,
<a href="#h8-1" id="h8-1" class="h">@@ -16,6 +17,6 @@ go_library(
</a> 
 go_binary(
     name = &quot;livegrep-github-reindex&quot;,
<a href="#h8-1-3" id="h8-1-3" class="d">-    library = &quot;:go_default_library&quot;,
</a><a href="#h8-1-4" id="h8-1-4" class="i">+    embed = [&quot;:go_default_library&quot;],
</a>     visibility = [&quot;//visibility:public&quot;],
 )
<b>diff --git a/<a id="h9" href="../file/cmd/livegrep-reload/BUILD">cmd/livegrep-reload/BUILD</a> b/<a href="../file/cmd/livegrep-reload/BUILD">cmd/livegrep-reload/BUILD</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -2,12 +2,11 @@ load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_binary&quot;, &quot;go_library&quot;)
</a> 
 go_library(
     name = &quot;go_default_library&quot;,
<a href="#h9-0-3" id="h9-0-3" class="d">-    srcs = [
</a><a href="#h9-0-4" id="h9-0-4" class="d">-        &quot;main.go&quot;,
</a><a href="#h9-0-5" id="h9-0-5" class="d">-    ],
</a><a href="#h9-0-6" id="h9-0-6" class="i">+    srcs = [&quot;main.go&quot;],
</a>     data = [
         &quot;//src/tools:codesearch&quot;,
     ],
<a href="#h9-0-10" id="h9-0-10" class="i">+    importpath = &quot;github.com/livegrep/livegrep/cmd/livegrep-reload&quot;,
</a>     visibility = [&quot;//visibility:private&quot;],
     deps = [
         &quot;//src/proto:go_proto&quot;,
<a href="#h9-1" id="h9-1" class="h">@@ -17,6 +16,6 @@ go_library(
</a> 
 go_binary(
     name = &quot;livegrep-reload&quot;,
<a href="#h9-1-3" id="h9-1-3" class="d">-    library = &quot;:go_default_library&quot;,
</a><a href="#h9-1-4" id="h9-1-4" class="i">+    embed = [&quot;:go_default_library&quot;],
</a>     visibility = [&quot;//visibility:public&quot;],
 )
<b>diff --git a/<a id="h10" href="../file/cmd/livegrep/BUILD">cmd/livegrep/BUILD</a> b/<a href="../file/cmd/livegrep/BUILD">cmd/livegrep/BUILD</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -3,6 +3,7 @@ load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_binary&quot;, &quot;go_library&quot;)
</a> go_library(
     name = &quot;go_default_library&quot;,
     srcs = [&quot;livegrep.go&quot;],
<a href="#h10-0-3" id="h10-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/cmd/livegrep&quot;,
</a>     visibility = [&quot;//visibility:private&quot;],
     deps = [
         &quot;//server:go_default_library&quot;,
<a href="#h10-1" id="h10-1" class="h">@@ -14,6 +15,6 @@ go_library(
</a> 
 go_binary(
     name = &quot;livegrep&quot;,
<a href="#h10-1-3" id="h10-1-3" class="d">-    library = &quot;:go_default_library&quot;,
</a><a href="#h10-1-4" id="h10-1-4" class="i">+    embed = [&quot;:go_default_library&quot;],
</a>     visibility = [&quot;//visibility:public&quot;],
 )
<b>diff --git a/<a id="h11" href="../file/jsonframe/BUILD">jsonframe/BUILD</a> b/<a href="../file/jsonframe/BUILD">jsonframe/BUILD</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -6,5 +6,6 @@ load(
</a> go_library(
     name = &quot;go_default_library&quot;,
     srcs = [&quot;jsonframe.go&quot;],
<a href="#h11-0-3" id="h11-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/jsonframe&quot;,
</a>     visibility = [&quot;//visibility:public&quot;],
 )
<b>diff --git a/<a id="h12" href="../file/package.sh">package.sh</a> b/<a href="../file/package.sh">package.sh</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -3,9 +3,8 @@ set -ex
</a> mkdir -p builds
 rev=$(git rev-parse HEAD | head -c10)
 builddir=&quot;livegrep-$rev&quot;
<a href="#h12-0-3" id="h12-0-3" class="d">-mkdir -p &quot;$builddir&quot;
</a><a href="#h12-0-4" id="h12-0-4" class="d">-cp -a doc README.md COPYING &quot;$builddir&quot;
</a><a href="#h12-0-5" id="h12-0-5" class="d">-mkdir -p &quot;$builddir/bin&quot;
</a><a href="#h12-0-6" id="h12-0-6" class="d">-cp -a $(bazel query &#39;kind(&quot;cc_binary|genrule&quot;, //src/tools/...) union kind(&quot;go_binary&quot;, //cmd/...)&#39; | sed -e s,^/,bazel-bin, -e s,:,/, -e s,/tool-,/,) &quot;$builddir/bin&quot;
</a><a href="#h12-0-7" id="h12-0-7" class="d">-cp -aL bazel-bin/cmd/livegrep/livegrep.runfiles/com_github_livegrep_livegrep/web &quot;$builddir&quot;
</a><a href="#h12-0-8" id="h12-0-8" class="i">+rm -rf &quot;$builddir&quot; &amp;&amp; mkdir &quot;$builddir&quot;
</a><a href="#h12-0-9" id="h12-0-9" class="i">+bazel build :livegrep
</a><a href="#h12-0-10" id="h12-0-10" class="i">+tar -C &quot;$builddir&quot; -xf bazel-bin/livegrep.tar
</a> tar -czf &quot;builds/$builddir.tgz&quot; &quot;$builddir&quot;
<a href="#h12-0-12" id="h12-0-12" class="i">+rm -rf &quot;$builddir&quot;
</a><b>diff --git a/<a id="h13" href="../file/server/BUILD">server/BUILD</a> b/<a href="../file/server/BUILD">server/BUILD</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -17,6 +17,7 @@ go_library(
</a>         &quot;//web:templates&quot;,
         &quot;//web:webpack_build&quot;,
     ],
<a href="#h13-0-3" id="h13-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/server&quot;,
</a>     visibility = [&quot;//visibility:public&quot;],
     deps = [
         &quot;//server/api:go_default_library&quot;,
<a href="#h13-1" id="h13-1" class="h">@@ -36,7 +37,10 @@ go_library(
</a> 
 go_test(
     name = &quot;go_default_test&quot;,
<a href="#h13-1-3" id="h13-1-3" class="d">-    srcs = [&quot;query_test.go&quot;, &quot;server_test.go&quot;],
</a><a href="#h13-1-4" id="h13-1-4" class="d">-    library = &quot;:go_default_library&quot;,
</a><a href="#h13-1-5" id="h13-1-5" class="i">+    srcs = [
</a><a href="#h13-1-6" id="h13-1-6" class="i">+        &quot;query_test.go&quot;,
</a><a href="#h13-1-7" id="h13-1-7" class="i">+        &quot;server_test.go&quot;,
</a><a href="#h13-1-8" id="h13-1-8" class="i">+    ],
</a><a href="#h13-1-9" id="h13-1-9" class="i">+    embed = [&quot;:go_default_library&quot;],
</a>     deps = [&quot;//src/proto:go_proto&quot;],
 )
<b>diff --git a/<a id="h14" href="../file/server/api/BUILD">server/api/BUILD</a> b/<a href="../file/server/api/BUILD">server/api/BUILD</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -3,5 +3,6 @@ load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_library&quot;)
</a> go_library(
     name = &quot;go_default_library&quot;,
     srcs = [&quot;types.go&quot;],
<a href="#h14-0-3" id="h14-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/server/api&quot;,
</a>     visibility = [&quot;//visibility:public&quot;],
 )
<b>diff --git a/<a id="h15" href="../file/server/config/BUILD">server/config/BUILD</a> b/<a href="../file/server/config/BUILD">server/config/BUILD</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -3,5 +3,6 @@ load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_library&quot;)
</a> go_library(
     name = &quot;go_default_library&quot;,
     srcs = [&quot;config.go&quot;],
<a href="#h15-0-3" id="h15-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/server/config&quot;,
</a>     visibility = [&quot;//visibility:public&quot;],
 )
<b>diff --git a/<a id="h16" href="../file/server/log/BUILD">server/log/BUILD</a> b/<a href="../file/server/log/BUILD">server/log/BUILD</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -3,6 +3,7 @@ load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_library&quot;)
</a> go_library(
     name = &quot;go_default_library&quot;,
     srcs = [&quot;log.go&quot;],
<a href="#h16-0-3" id="h16-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/server/log&quot;,
</a>     visibility = [&quot;//visibility:public&quot;],
     deps = [
         &quot;//server/reqid:go_default_library&quot;,
<b>diff --git a/<a id="h17" href="../file/server/middleware/BUILD">server/middleware/BUILD</a> b/<a href="../file/server/middleware/BUILD">server/middleware/BUILD</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -3,5 +3,6 @@ load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_library&quot;)
</a> go_library(
     name = &quot;go_default_library&quot;,
     srcs = [&quot;reverse_proxy.go&quot;],
<a href="#h17-0-3" id="h17-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/server/middleware&quot;,
</a>     visibility = [&quot;//visibility:public&quot;],
 )
<b>diff --git a/<a id="h18" href="../file/server/reqid/BUILD">server/reqid/BUILD</a> b/<a href="../file/server/reqid/BUILD">server/reqid/BUILD</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -3,6 +3,7 @@ load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_library&quot;)
</a> go_library(
     name = &quot;go_default_library&quot;,
     srcs = [&quot;reqid.go&quot;],
<a href="#h18-0-3" id="h18-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/server/reqid&quot;,
</a>     visibility = [&quot;//visibility:public&quot;],
     deps = [&quot;@org_golang_x_net//context:go_default_library&quot;],
 )
<b>diff --git a/<a id="h19" href="../file/server/templates/BUILD">server/templates/BUILD</a> b/<a href="../file/server/templates/BUILD">server/templates/BUILD</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -3,5 +3,6 @@ load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_library&quot;)
</a> go_library(
     name = &quot;go_default_library&quot;,
     srcs = [&quot;templates.go&quot;],
<a href="#h19-0-3" id="h19-0-3" class="i">+    importpath = &quot;github.com/livegrep/livegrep/server/templates&quot;,
</a>     visibility = [&quot;//visibility:public&quot;],
 )
<b>diff --git a/<a id="h20" href="../file/src/proto/BUILD">src/proto/BUILD</a> b/<a href="../file/src/proto/BUILD">src/proto/BUILD</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -1,12 +1,19 @@
</a> package(default_visibility = [&quot;//visibility:public&quot;])
 
<a href="#h20-0-2" id="h20-0-2" class="d">-load(&quot;@org_pubref_rules_protobuf//go:rules.bzl&quot;, &quot;go_proto_library&quot;)
</a><a href="#h20-0-3" id="h20-0-3" class="i">+load(&quot;@io_bazel_rules_go//proto:def.bzl&quot;, &quot;go_proto_library&quot;)
</a> load(&quot;@org_pubref_rules_protobuf//cpp:rules.bzl&quot;, &quot;cc_proto_library&quot;)
 
<a href="#h20-0-6" id="h20-0-6" class="i">+proto_library(
</a><a href="#h20-0-7" id="h20-0-7" class="i">+    name = &quot;livegrep_proto&quot;,
</a><a href="#h20-0-8" id="h20-0-8" class="i">+    srcs = [&quot;livegrep.proto&quot;],
</a><a href="#h20-0-9" id="h20-0-9" class="i">+)
</a><a href="#h20-0-10" id="h20-0-10" class="i">+
</a> go_proto_library(
     name = &quot;go_proto&quot;,
<a href="#h20-0-13" id="h20-0-13" class="d">-    protos = [&quot;livegrep.proto&quot;],
</a><a href="#h20-0-14" id="h20-0-14" class="d">-    with_grpc = True,
</a><a href="#h20-0-15" id="h20-0-15" class="i">+    compilers = [&quot;@io_bazel_rules_go//proto:go_grpc&quot;],
</a><a href="#h20-0-16" id="h20-0-16" class="i">+    importpath = &quot;github.com/livegrep/livegrep/src/proto/go_proto&quot;,
</a><a href="#h20-0-17" id="h20-0-17" class="i">+    proto = &quot;:livegrep_proto&quot;,
</a><a href="#h20-0-18" id="h20-0-18" class="i">+    visibility = [&quot;//visibility:public&quot;],
</a> )
 
 cc_proto_library(
<b>diff --git a/<a id="h21" href="../file/src/tools/BUILD">src/tools/BUILD</a> b/<a href="../file/src/tools/BUILD">src/tools/BUILD</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -1,6 +1,7 @@
</a> package(default_visibility = [&quot;//visibility:public&quot;])
 
 load(&quot;@org_pubref_rules_protobuf//cpp:rules.bzl&quot;, &quot;GRPC_COMPILE_DEPS&quot;)
<a href="#h21-0-3" id="h21-0-3" class="i">+load(&quot;@bazel_tools//tools/build_defs/pkg:pkg.bzl&quot;, &quot;pkg_tar&quot;)
</a> 
 cc_library(
     name = &quot;grpc_server&quot;,
<a href="#h21-1" id="h21-1" class="h">@@ -64,3 +65,16 @@ cc_binary(
</a>     &quot;dump-file&quot;,
     &quot;inspect-index&quot;,
 ]]
<a href="#h21-1-3" id="h21-1-3" class="i">+
</a><a href="#h21-1-4" id="h21-1-4" class="i">+pkg_tar(
</a><a href="#h21-1-5" id="h21-1-5" class="i">+    name = &quot;cc_tools&quot;,
</a><a href="#h21-1-6" id="h21-1-6" class="i">+    srcs = [
</a><a href="#h21-1-7" id="h21-1-7" class="i">+        &quot;:analyze-re&quot;,
</a><a href="#h21-1-8" id="h21-1-8" class="i">+        &quot;:codesearch&quot;,
</a><a href="#h21-1-9" id="h21-1-9" class="i">+        &quot;:codesearchtool&quot;,
</a><a href="#h21-1-10" id="h21-1-10" class="i">+        &quot;:dump-file&quot;,
</a><a href="#h21-1-11" id="h21-1-11" class="i">+        &quot;:grpc_server&quot;,
</a><a href="#h21-1-12" id="h21-1-12" class="i">+        &quot;:inspect-index&quot;,
</a><a href="#h21-1-13" id="h21-1-13" class="i">+    ],
</a><a href="#h21-1-14" id="h21-1-14" class="i">+    package_dir = &quot;bin/&quot;,
</a><a href="#h21-1-15" id="h21-1-15" class="i">+)
</a><b>diff --git a/<a id="h22" href="../file/third_party/BUILD.json_c">third_party/BUILD.json_c</a> b/<a href="../file/third_party/BUILD.json_c">third_party/BUILD.json_c</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -1,8 +1,15 @@
</a> cc_library(
<a href="#h22-0-1" id="h22-0-1" class="d">-  name = &quot;json&quot;,
</a><a href="#h22-0-2" id="h22-0-2" class="d">-  srcs = glob([&quot;json-c/*.c&quot;])+[&quot;json-c/config.h&quot;],
</a><a href="#h22-0-3" id="h22-0-3" class="d">-  hdrs = glob([&quot;json-c/*.h&quot;], exclude=[&quot;json-c/config.h&quot;]),
</a><a href="#h22-0-4" id="h22-0-4" class="d">-  includes = [&quot;.&quot;],
</a><a href="#h22-0-5" id="h22-0-5" class="d">-  copts = [&quot;-Iexternal/com_github_json_c/json-c/&quot;],
</a><a href="#h22-0-6" id="h22-0-6" class="d">-  visibility = [&quot;//visibility:public&quot;],
</a><a href="#h22-0-7" id="h22-0-7" class="i">+    name = &quot;json&quot;,
</a><a href="#h22-0-8" id="h22-0-8" class="i">+    srcs = glob([
</a><a href="#h22-0-9" id="h22-0-9" class="i">+        &quot;*.c&quot;,
</a><a href="#h22-0-10" id="h22-0-10" class="i">+        &quot;*.h&quot;,
</a><a href="#h22-0-11" id="h22-0-11" class="i">+    ]),
</a><a href="#h22-0-12" id="h22-0-12" class="i">+    hdrs = glob(
</a><a href="#h22-0-13" id="h22-0-13" class="i">+        [&quot;*.h&quot;],
</a><a href="#h22-0-14" id="h22-0-14" class="i">+        exclude = [&quot;config.h&quot;],
</a><a href="#h22-0-15" id="h22-0-15" class="i">+    ),
</a><a href="#h22-0-16" id="h22-0-16" class="i">+    copts = [&quot;-Iexternal/com_github_json_c/&quot;],
</a><a href="#h22-0-17" id="h22-0-17" class="i">+    include_prefix = &quot;json-c/&quot;,
</a><a href="#h22-0-18" id="h22-0-18" class="i">+    includes = [&quot;.&quot;],
</a><a href="#h22-0-19" id="h22-0-19" class="i">+    visibility = [&quot;//visibility:public&quot;],
</a> )
<b>diff --git a/<a id="h23" href="../file/tools/build_defs/externals.bzl">tools/build_defs/externals.bzl</a> b/<a href="../file/tools/build_defs/externals.bzl">tools/build_defs/externals.bzl</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -1,27 +0,0 @@
</a><a href="#h23-0-0" id="h23-0-0" class="d">-def _new_patched_http_archive_impl(ctx):
</a><a href="#h23-0-1" id="h23-0-1" class="d">-  ctx.download_and_extract(
</a><a href="#h23-0-2" id="h23-0-2" class="d">-    ctx.attr.url,
</a><a href="#h23-0-3" id="h23-0-3" class="d">-    ctx.attr.add_prefix,
</a><a href="#h23-0-4" id="h23-0-4" class="d">-    ctx.attr.sha256,
</a><a href="#h23-0-5" id="h23-0-5" class="d">-    ctx.attr.type,
</a><a href="#h23-0-6" id="h23-0-6" class="d">-    ctx.attr.strip_prefix,
</a><a href="#h23-0-7" id="h23-0-7" class="d">-  )
</a><a href="#h23-0-8" id="h23-0-8" class="d">-  ctx.symlink(ctx.attr.build_file, &quot;BUILD&quot;)
</a><a href="#h23-0-9" id="h23-0-9" class="d">-  cmd = ctx.execute(
</a><a href="#h23-0-10" id="h23-0-10" class="d">-    [&quot;patch&quot;, &quot;-d&quot;, ctx.attr.add_prefix, &quot;-i&quot;, ctx.path(ctx.attr.patch_file)] +
</a><a href="#h23-0-11" id="h23-0-11" class="d">-    ctx.attr.patch_args,)
</a><a href="#h23-0-12" id="h23-0-12" class="d">-  if cmd.return_code != 0:
</a><a href="#h23-0-13" id="h23-0-13" class="d">-    fail(&quot;error patching: &quot; + cmd.stderr)
</a><a href="#h23-0-14" id="h23-0-14" class="d">-
</a><a href="#h23-0-15" id="h23-0-15" class="d">-new_patched_http_archive = repository_rule(
</a><a href="#h23-0-16" id="h23-0-16" class="d">-  implementation=_new_patched_http_archive_impl,
</a><a href="#h23-0-17" id="h23-0-17" class="d">-  attrs = {
</a><a href="#h23-0-18" id="h23-0-18" class="d">-    &quot;url&quot;: attr.string(mandatory = True),
</a><a href="#h23-0-19" id="h23-0-19" class="d">-    &quot;sha256&quot;: attr.string(),
</a><a href="#h23-0-20" id="h23-0-20" class="d">-    &quot;build_file&quot;: attr.label(mandatory = True),
</a><a href="#h23-0-21" id="h23-0-21" class="d">-    &quot;patch_file&quot;: attr.label(mandatory = True),
</a><a href="#h23-0-22" id="h23-0-22" class="d">-    &quot;strip_prefix&quot;: attr.string(),
</a><a href="#h23-0-23" id="h23-0-23" class="d">-    &quot;type&quot;: attr.string(),
</a><a href="#h23-0-24" id="h23-0-24" class="d">-    &quot;patch_args&quot;: attr.string_list(default=[&quot;-p1&quot;]),
</a><a href="#h23-0-25" id="h23-0-25" class="d">-    &quot;add_prefix&quot;: attr.string(default=&quot;.&quot;),
</a><a href="#h23-0-26" id="h23-0-26" class="d">-  })
</a><b>diff --git a/<a id="h24" href="../file/tools/build_defs/go_externals.bzl">tools/build_defs/go_externals.bzl</a> b/<a href="../file/tools/build_defs/go_externals.bzl">tools/build_defs/go_externals.bzl</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -1,23 +1,25 @@
</a> load(
<a href="#h24-0-1" id="h24-0-1" class="d">-    &quot;@io_bazel_rules_go//go:def.bzl&quot;,
</a><a href="#h24-0-2" id="h24-0-2" class="i">+    &quot;@bazel_gazelle//:deps.bzl&quot;,
</a>     &quot;go_repository&quot;,
 )
 
 def _github(repo, commit):
<a href="#h24-0-7" id="h24-0-7" class="d">-  name = &quot;com_github_&quot; + repo.replace(&quot;/&quot;, &quot;_&quot;).replace(&quot;-&quot;, &quot;_&quot;).replace(&quot;.&quot;, &quot;_&quot;)
</a><a href="#h24-0-8" id="h24-0-8" class="d">-  importpath = &quot;github.com/&quot; + repo
</a><a href="#h24-0-9" id="h24-0-9" class="d">-  return struct(
</a><a href="#h24-0-10" id="h24-0-10" class="d">-    name = name,
</a><a href="#h24-0-11" id="h24-0-11" class="d">-    importpath = importpath,
</a><a href="#h24-0-12" id="h24-0-12" class="d">-    commit = commit)
</a><a href="#h24-0-13" id="h24-0-13" class="i">+    name = &quot;com_github_&quot; + repo.replace(&quot;/&quot;, &quot;_&quot;).replace(&quot;-&quot;, &quot;_&quot;).replace(&quot;.&quot;, &quot;_&quot;)
</a><a href="#h24-0-14" id="h24-0-14" class="i">+    importpath = &quot;github.com/&quot; + repo
</a><a href="#h24-0-15" id="h24-0-15" class="i">+    return struct(
</a><a href="#h24-0-16" id="h24-0-16" class="i">+        name = name,
</a><a href="#h24-0-17" id="h24-0-17" class="i">+        commit = commit,
</a><a href="#h24-0-18" id="h24-0-18" class="i">+        importpath = importpath,
</a><a href="#h24-0-19" id="h24-0-19" class="i">+    )
</a> 
 def _golang_x(pkg, commit):
<a href="#h24-0-22" id="h24-0-22" class="d">-  name = &quot;org_golang_x_&quot; + pkg
</a><a href="#h24-0-23" id="h24-0-23" class="d">-  importpath = &quot;golang.org/x/&quot; + pkg
</a><a href="#h24-0-24" id="h24-0-24" class="d">-  return struct(
</a><a href="#h24-0-25" id="h24-0-25" class="d">-    name = name,
</a><a href="#h24-0-26" id="h24-0-26" class="d">-    importpath = importpath,
</a><a href="#h24-0-27" id="h24-0-27" class="d">-    commit = commit)
</a><a href="#h24-0-28" id="h24-0-28" class="i">+    name = &quot;org_golang_x_&quot; + pkg
</a><a href="#h24-0-29" id="h24-0-29" class="i">+    importpath = &quot;golang.org/x/&quot; + pkg
</a><a href="#h24-0-30" id="h24-0-30" class="i">+    return struct(
</a><a href="#h24-0-31" id="h24-0-31" class="i">+        name = name,
</a><a href="#h24-0-32" id="h24-0-32" class="i">+        commit = commit,
</a><a href="#h24-0-33" id="h24-0-33" class="i">+        importpath = importpath,
</a><a href="#h24-0-34" id="h24-0-34" class="i">+    )
</a> 
 _externals = [
     _golang_x(&quot;net&quot;, &quot;d212a1ef2de2f5d441c327b8f26cf3ea3ea9f265&quot;),
<a href="#h24-1" id="h24-1" class="h">@@ -51,16 +53,18 @@ _externals = [
</a> ]
 
 def go_externals():
<a href="#h24-1-3" id="h24-1-3" class="d">-  for ext in _externals:
</a><a href="#h24-1-4" id="h24-1-4" class="d">-    if hasattr(ext, &#39;vcs&#39;):
</a><a href="#h24-1-5" id="h24-1-5" class="d">-      go_repository(
</a><a href="#h24-1-6" id="h24-1-6" class="d">-        name = ext.name,
</a><a href="#h24-1-7" id="h24-1-7" class="d">-        importpath = ext.importpath,
</a><a href="#h24-1-8" id="h24-1-8" class="d">-        commit = ext.commit,
</a><a href="#h24-1-9" id="h24-1-9" class="d">-        vcs = ext.vcs,
</a><a href="#h24-1-10" id="h24-1-10" class="d">-        remote = ext.remote)
</a><a href="#h24-1-11" id="h24-1-11" class="d">-    else:
</a><a href="#h24-1-12" id="h24-1-12" class="d">-      go_repository(
</a><a href="#h24-1-13" id="h24-1-13" class="d">-        name = ext.name,
</a><a href="#h24-1-14" id="h24-1-14" class="d">-        importpath = ext.importpath,
</a><a href="#h24-1-15" id="h24-1-15" class="d">-        commit = ext.commit)
</a><a href="#h24-1-16" id="h24-1-16" class="i">+    for ext in _externals:
</a><a href="#h24-1-17" id="h24-1-17" class="i">+        if hasattr(ext, &quot;vcs&quot;):
</a><a href="#h24-1-18" id="h24-1-18" class="i">+            go_repository(
</a><a href="#h24-1-19" id="h24-1-19" class="i">+                name = ext.name,
</a><a href="#h24-1-20" id="h24-1-20" class="i">+                commit = ext.commit,
</a><a href="#h24-1-21" id="h24-1-21" class="i">+                importpath = ext.importpath,
</a><a href="#h24-1-22" id="h24-1-22" class="i">+                remote = ext.remote,
</a><a href="#h24-1-23" id="h24-1-23" class="i">+                vcs = ext.vcs,
</a><a href="#h24-1-24" id="h24-1-24" class="i">+            )
</a><a href="#h24-1-25" id="h24-1-25" class="i">+        else:
</a><a href="#h24-1-26" id="h24-1-26" class="i">+            go_repository(
</a><a href="#h24-1-27" id="h24-1-27" class="i">+                name = ext.name,
</a><a href="#h24-1-28" id="h24-1-28" class="i">+                commit = ext.commit,
</a><a href="#h24-1-29" id="h24-1-29" class="i">+                importpath = ext.importpath,
</a><a href="#h24-1-30" id="h24-1-30" class="i">+            )
</a><b>diff --git a/<a id="h25" href="../file/web/BUILD">web/BUILD</a> b/<a href="../file/web/BUILD">web/BUILD</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -1,6 +1,7 @@
</a> package(default_visibility = [&quot;//visibility:public&quot;])
 
 load(&quot;@org_dropbox_rules_node//node:defs.bzl&quot;, &quot;webpack_build&quot;)
<a href="#h25-0-3" id="h25-0-3" class="i">+load(&quot;@bazel_tools//tools/build_defs/pkg:pkg.bzl&quot;, &quot;pkg_tar&quot;)
</a> 
 filegroup(
     name = &quot;templates&quot;,
<a href="#h25-1" id="h25-1" class="h">@@ -38,3 +39,15 @@ genrule(
</a>     outs = [&quot;hashes.txt&quot;],
     cmd = &quot;sha256sum $(SRCS) | sed \&quot;s_ $(BINDIR)/_ _\&quot; | sed \&quot;s_ web/htdocs/_ _\&quot;&gt; $@&quot;,
 )
<a href="#h25-1-3" id="h25-1-3" class="i">+
</a><a href="#h25-1-4" id="h25-1-4" class="i">+pkg_tar(
</a><a href="#h25-1-5" id="h25-1-5" class="i">+    name = &quot;assets&quot;,
</a><a href="#h25-1-6" id="h25-1-6" class="i">+    srcs = [
</a><a href="#h25-1-7" id="h25-1-7" class="i">+        &quot;:asset_hashes&quot;,
</a><a href="#h25-1-8" id="h25-1-8" class="i">+        &quot;:htdocs&quot;,
</a><a href="#h25-1-9" id="h25-1-9" class="i">+        &quot;:templates&quot;,
</a><a href="#h25-1-10" id="h25-1-10" class="i">+        &quot;:webpack_build&quot;,
</a><a href="#h25-1-11" id="h25-1-11" class="i">+    ],
</a><a href="#h25-1-12" id="h25-1-12" class="i">+    package_dir = &quot;web/&quot;,
</a><a href="#h25-1-13" id="h25-1-13" class="i">+    strip_prefix = &quot;.&quot;,
</a><a href="#h25-1-14" id="h25-1-14" class="i">+)
</a></pre>
</div>
</body>
</html>
